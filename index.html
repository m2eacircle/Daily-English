<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="description" content="Daily English â€” ë§¤ì¼ ì˜ì–´ í‘œí˜„ í•˜ë‚˜ì”© ë°°ì›Œë³´ì„¸ìš”. Learn one English expression per day through your favorite TV shows.">
  <title>Daily English â€” ONE Expression per DAY</title>
  <link rel="stylesheet" href="css/style.css">
  <!-- PWA -->
  <link rel="manifest" href="manifest.json">
  <meta name="theme-color" content="#38bdf8">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="apple-mobile-web-app-title" content="Daily English">
  <link rel="apple-touch-icon" href="icons/icon-192.png">
  <style>
    /* â”€â”€ Install banner â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .install-banner {
      display: none;
      position: fixed;
      bottom: 20px;
      left: 50%;
      transform: translateX(-50%);
      z-index: 400;
      background: var(--card2);
      border: 1px solid var(--accent);
      border-radius: 16px;
      padding: 14px 18px;
      box-shadow: 0 8px 32px rgba(0,0,0,0.5);
      max-width: 420px;
      width: calc(100% - 32px);
      animation: slideUp 0.35s ease;
    }
    .install-banner.show { display: flex; align-items: center; gap: 12px; }
    @keyframes slideUp {
      from { opacity: 0; transform: translateX(-50%) translateY(20px); }
      to   { opacity: 1; transform: translateX(-50%) translateY(0); }
    }
    .install-banner-icon { font-size: 2rem; flex-shrink: 0; }
    .install-banner-text { flex: 1; }
    .install-banner-text strong { font-size: 0.9rem; color: var(--text); display: block; margin-bottom: 2px; }
    .install-banner-text span   { font-size: 0.78rem; color: var(--muted); }
    .install-banner-actions { display: flex; gap: 6px; flex-shrink: 0; flex-direction: column; }
    .btn-install {
      background: var(--accent); color: var(--bg);
      border: none; border-radius: 8px;
      padding: 8px 14px; font-size: 0.8rem; font-weight: 800;
      cursor: pointer; font-family: inherit; white-space: nowrap;
      transition: all 0.2s;
    }
    .btn-install:hover { background: #0ea5e9; }
    .btn-dismiss {
      background: none; color: var(--muted);
      border: 1px solid var(--border); border-radius: 8px;
      padding: 6px 10px; font-size: 0.75rem; font-weight: 700;
      cursor: pointer; font-family: inherit;
    }
    .btn-dismiss:hover { color: var(--text); }

    /* Fix banner accent border override */
    #fixBanner { border-color: var(--accent2) !important; }
    #fixBanner .install-banner-text strong { color: var(--accent2); }
    .terms-overlay {
      position: fixed; inset: 0;
      background: var(--bg);
      z-index: 500;
      overflow-y: auto;
      display: none;
    }
    .terms-overlay.visible { display: block; }

    /* â”€â”€ Main content hidden until agreed â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    #mainContent { display: none; }
    #mainContent.visible { display: block; }

    /* â”€â”€ Language toggle pill â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .lang-toggle {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 0;
      margin: 0 auto 28px;
      background: var(--card);
      border: 1px solid var(--border);
      border-radius: 30px;
      padding: 4px;
      width: fit-content;
    }
    .lang-btn {
      background: none;
      border: none;
      border-radius: 24px;
      padding: 9px 28px;
      font-size: 0.9rem;
      font-weight: 800;
      font-family: 'Nunito', sans-serif;
      color: var(--muted);
      cursor: pointer;
      transition: all 0.22s ease;
      letter-spacing: 0.5px;
      display: flex;
      align-items: center;
      gap: 7px;
    }
    .lang-btn.active {
      background: var(--accent);
      color: var(--bg);
      box-shadow: 0 2px 14px rgba(56,189,248,0.42);
    }
    .lang-btn:not(.active):hover {
      color: var(--text);
      background: var(--card2);
    }
    .lang-flag { font-size: 1.1rem; line-height: 1; }

    /* â”€â”€ Language content blocks â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .lang-content { display: none; }
    .lang-content.visible { display: block; }

    /* â”€â”€ Korean typography â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .ko-text {
      font-family: 'Malgun Gothic', 'Apple SD Gothic Neo', 'Noto Sans KR', 'Nunito', sans-serif;
      word-break: keep-all;
    }
    .ko-text .terms-card p,
    .ko-text .terms-list li {
      font-size: 0.9rem;
      line-height: 1.92;
    }
    .ko-text .terms-check-wrap label {
      font-size: 0.88rem;
      line-height: 1.85;
    }
    .ko-text .terms-hero-title {
      font-size: 1.42rem;
      line-height: 1.42;
    }
    .ko-text .terms-hero-sub {
      font-size: 0.82rem;
    }
    .ko-text .btn-agree {
      font-size: 0.95rem;
    }
  </style>
</head>
<body>

<!-- â”€â”€ TOP BAR â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
<header class="topbar">
  <div class="topbar-left">
    <button class="btn-topbar-home" onclick="goHome()" title="Home" aria-label="Home">&#127968;</button>
    <div class="topbar-logo">
      <span class="logo-accent">Daily</span> <span class="logo-day">English</span>
    </div>
  </div>
  <div class="topbar-right">
    <a class="m2ea-link" href="https://www.m2eacircle.com/entertainment/index.html" target="_blank" rel="noopener" title="Visit m2ea Circle">
      <span class="m2ea-icon">&#127760;</span>
      <span class="label">m2ea Circle</span>
    </a>
  </div>
</header>


<!-- =====================================================
     TERMS OF USE OVERLAY
====================================================== -->
<div class="terms-overlay visible" id="termsOverlay">
  <div class="terms-wrap">

    <!-- Language Toggle -->
    <div class="lang-toggle" role="group" aria-label="Language / ì–¸ì–´ ì„ íƒ">
      <button class="lang-btn" id="btn-en" onclick="setLang('en')" aria-pressed="false">
        <span class="lang-flag">&#127482;&#127480;</span> EN
      </button>
      <button class="lang-btn active" id="btn-ko" onclick="setLang('ko')" aria-pressed="true">
        <span class="lang-flag">&#127472;&#127479;</span> KO
      </button>
    </div>


    <!-- ================================================
         ENGLISH TERMS
    ================================================= -->
    <div class="lang-content" id="content-en">

      <div class="terms-hero">
        <div class="terms-hero-icon">&#128214;</div>
        <div class="terms-hero-title">Daily English<br>ONE Expression per DAY</div>
        <div class="terms-hero-sub">by m2ea Laps &mdash; Please read and agree to our Terms of Use to continue</div>
      </div>

      <div class="terms-card">
        <div class="terms-card-title">&#128203; Welcome</div>
        <p>Welcome to <strong>Daily English (ONE Expression per DAY)</strong>. This application is designed to help you study English through real-world video content, one expression at a time.</p>
        <p>Please read the following Terms of Use carefully before accessing the application.</p>
      </div>

      <div class="terms-card">
        <div class="terms-card-title">&#128204; Terms of Use</div>
        <ul class="terms-list">
          <li>This app is for <strong>study purposes only</strong>. All video clips&rsquo; rights belong to each respective company. If any company requests content removal, all contents can be removed without prior notice.</li>
          <li>You <strong>cannot use this content for any other purposes</strong>. Use is strictly limited to <strong>personal study only</strong>. Any commercial, redistribution, or other non-personal use is prohibited.</li>
          <li>All study contents and comments <strong>may contain incorrect or inaccurate information</strong>. All explanations and comments represent a <strong>m2ea Laps opinion</strong>. If you have a different idea or opinion, <em>you are right</em> &mdash; please use your own judgment.</li>
        </ul>
      </div>

      <div class="terms-card">
        <div class="terms-card-title">&#8505;&#65039; About This App</div>
        <p>Daily English connects short YouTube video clips to real English expressions used in popular TV shows. Each expression includes its meaning, an example sentence, and a link to a short video clip for context.</p>
        <p>This app is operated by <strong>m2ea Laps</strong> as a study group project. All video content remains the property of its original owners. YouTube video clips and shorts may include ads served by YouTube.</p>
      </div>

      <div class="terms-check-wrap" onclick="handleCheckClick('en', event)">
        <input type="checkbox" id="agreeCheck-en" onchange="onCheckChange('en')" aria-label="Agree to Terms of Use">
        <label for="agreeCheck-en">
          I have read and fully agree to the <strong>Terms of Use</strong> above.
          I understand this application is for personal study only and that all video content
          rights belong to their respective owners.
        </label>
      </div>

      <button class="btn-agree" id="btnAgree-en" onclick="agreeAndEnter()" disabled aria-disabled="true">
        Agree &amp; Start Learning &#9658;
      </button>

    </div><!-- /content-en -->


    <!-- ================================================
         KOREAN TERMS (ì´ìš©ì•½ê´€)
    ================================================= -->
    <div class="lang-content visible ko-text" id="content-ko">

      <div class="terms-hero">
        <div class="terms-hero-icon">&#128214;</div>
        <div class="terms-hero-title">Daily English<br>ë§¤ì¼ í•œ í‘œí˜„</div>
        <div class="terms-hero-sub">by m2ea Laps &mdash; ì´ìš©ì•½ê´€ì„ ì½ê³  ë™ì˜í•˜ì‹  í›„ ì•±ì„ ì‚¬ìš©í•˜ì‹¤ ìˆ˜ ìˆìŠµë‹ˆë‹¤</div>
      </div>

      <div class="terms-card">
        <div class="terms-card-title">&#128203; í™˜ì˜í•©ë‹ˆë‹¤</div>
        <p><strong>Daily English (ë§¤ì¼ í•œ í‘œí˜„)</strong>ì— ì˜¤ì‹  ê²ƒì„ í™˜ì˜í•©ë‹ˆë‹¤. ì´ ì•±ì€ ì‹¤ì œ ì˜ìƒ ì½˜í…ì¸ ë¥¼ í†µí•´ ë§¤ì¼ ì˜ì–´ í‘œí˜„ í•˜ë‚˜ì”© ìì—°ìŠ¤ëŸ½ê²Œ í•™ìŠµí•  ìˆ˜ ìˆë„ë¡ ì œì‘ëœ ì˜ì–´ í•™ìŠµ ì•±ì…ë‹ˆë‹¤.</p>
        <p>ì•±ì„ ì´ìš©í•˜ì‹œê¸° ì „ì— ì•„ë˜ ì´ìš©ì•½ê´€ì„ ì£¼ì˜ ê¹Šê²Œ ì½ì–´ì£¼ì‹œê¸° ë°”ëë‹ˆë‹¤.</p>
      </div>

      <div class="terms-card">
        <div class="terms-card-title">&#128204; ì´ìš©ì•½ê´€</div>
        <ul class="terms-list">
          <li>ì´ ì•±ì€ <strong>í•™ìŠµ ëª©ì ìœ¼ë¡œë§Œ</strong> ì‚¬ìš© ê°€ëŠ¥í•©ë‹ˆë‹¤. ëª¨ë“  ì˜ìƒ í´ë¦½ì˜ ì €ì‘ê¶Œì€ ê° í•´ë‹¹ íšŒì‚¬ì— ìˆìœ¼ë©°, ì €ì‘ê¶Œìì˜ ìš”ì²­ì´ ìˆì„ ê²½ìš° <strong>ì˜ˆê³  ì—†ì´ ì½˜í…ì¸ ê°€ ì‚­ì œë  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</strong></li>
          <li>ì´ ì½˜í…ì¸ ëŠ” <strong>ë‹¤ë¥¸ ëª©ì ìœ¼ë¡œ ì‚¬ìš©í•˜ì‹¤ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.</strong> ì‚¬ìš©ì€ <strong>ê°œì¸ í•™ìŠµ ëª©ì ì— í•œì •</strong>ë˜ë©°, ìƒì—…ì  ì´ìš©Â·ì¬ë°°í¬ ë° ê¸°íƒ€ ë¹„ê°œì¸ì  ì‚¬ìš©ì€ ê¸ˆì§€ë©ë‹ˆë‹¤.</li>
          <li>ëª¨ë“  í•™ìŠµ ë‚´ìš© ë° ì„¤ëª…ì€ <strong>ì˜ëª»ëœ ì •ë³´ë¥¼ í¬í•¨í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</strong> ëª¨ë“  ì„¤ëª…ê³¼ í•´ì„¤ì€ <strong>m2ea Lapsì˜ ê°œì¸ì ì¸ ì˜ê²¬</strong>ì…ë‹ˆë‹¤. ë‹¤ë¥¸ ìƒê°ì´ë‚˜ ì˜ê²¬ì´ ìˆìœ¼ì‹œë‹¤ë©´ <em>ì—¬ëŸ¬ë¶„ì´ ë§ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤</em> &mdash; ë³¸ì¸ì˜ íŒë‹¨ì„ ë”°ë¥´ì‹œê¸° ë°”ëë‹ˆë‹¤.</li>
        </ul>
      </div>

      <div class="terms-card">
        <div class="terms-card-title">&#8505;&#65039; ì•± ì†Œê°œ</div>
        <p>Daily EnglishëŠ” ì¸ê¸° TV ë“œë¼ë§ˆì—ì„œ ì‹¤ì œë¡œ ì‚¬ìš©ë˜ëŠ” ì˜ì–´ í‘œí˜„ì„ ì§§ì€ ìœ íŠœë¸Œ ì˜ìƒ í´ë¦½ê³¼ ì—°ê²°í•˜ì—¬ ì œê³µí•©ë‹ˆë‹¤. ê° í‘œí˜„ì—ëŠ” ì˜ë¯¸ ì„¤ëª…, ì˜ˆë¬¸, ê·¸ë¦¬ê³  ì‹¤ì œ ì‚¬ìš© ì¥ë©´ì„ ë‹´ì€ ì˜ìƒ ë§í¬ê°€ í¬í•¨ë˜ì–´ ìˆìŠµë‹ˆë‹¤.</p>
        <p>ì´ ì•±ì€ <strong>m2ea Laps</strong>ì—ì„œ í•™ìŠµ ê·¸ë£¹ í”„ë¡œì íŠ¸ë¡œ ìš´ì˜ë©ë‹ˆë‹¤. ëª¨ë“  ì˜ìƒ ì½˜í…ì¸ ì˜ ì €ì‘ê¶Œì€ ì›ì €ì‘ìì—ê²Œ ìˆìœ¼ë©°, ìœ íŠœë¸Œ ì˜ìƒ ë° ì‡¼ì¸ ì—ëŠ” ìœ íŠœë¸Œê°€ ì œê³µí•˜ëŠ” ê´‘ê³ ê°€ í¬í•¨ë  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>
      </div>

      <div class="terms-check-wrap" onclick="handleCheckClick('ko', event)">
        <input type="checkbox" id="agreeCheck-ko" onchange="onCheckChange('ko')" aria-label="ì´ìš©ì•½ê´€ì— ë™ì˜í•©ë‹ˆë‹¤">
        <label for="agreeCheck-ko">
          ìœ„ì˜ <strong>ì´ìš©ì•½ê´€</strong>ì„ ëª¨ë‘ ì½ì—ˆìœ¼ë©° ì´ì— ë™ì˜í•©ë‹ˆë‹¤.
          ë³¸ ì•±ì´ ê°œì¸ í•™ìŠµ ëª©ì ìœ¼ë¡œë§Œ ì‚¬ìš© ê°€ëŠ¥í•˜ë©°, ëª¨ë“  ì˜ìƒ ì½˜í…ì¸ ì˜
          ì €ì‘ê¶Œì€ ê° ì›ì €ì‘ìì—ê²Œ ìˆìŒì„ ì´í•´í•©ë‹ˆë‹¤.
        </label>
      </div>

      <button class="btn-agree" id="btnAgree-ko" onclick="agreeAndEnter()" disabled aria-disabled="true">
        ë™ì˜í•˜ê³  í•™ìŠµ ì‹œì‘í•˜ê¸° &#9658;
      </button>

    </div><!-- /content-ko -->

  </div><!-- /terms-wrap -->
</div><!-- /termsOverlay -->


<!-- =====================================================
     MAIN CONTENT (after agreement)
====================================================== -->
<main id="mainContent">
  <div class="page-wrap">

    <div class="home-hero">
      <h1>&#127916; <span class="accent">ONE</span> Expression <span class="day">per DAY</span></h1>
      <p>Learn natural, everyday English expressions through iconic TV shows and video clips &mdash; one expression at a time.</p>
    </div>

    <div class="bookmark-bar" id="bookmarkBar">
      <div class="bookmark-bar-head">
        <span class="bm-icon">&#128278;</span>
        <span>Your Bookmarks &mdash; Jump back to where you left off</span>
      </div>
      <div class="bookmark-chips" id="bookmarkChips"></div>
    </div>

    <div class="section-label">&#128250; Shows</div>
    <div class="show-grid">

      <!-- FRIENDS -->
      <a class="show-card" href="friends/index.html" id="card-friends">
        <button class="bm-corner" data-bm-id="show-friends"
          onclick="event.preventDefault(); event.stopPropagation();
                   toggleBookmark('show','show-friends','ğŸ“º Friends','friends/index.html')"
          title="Bookmark Friends" aria-label="Bookmark Friends">&#128278;</button>
        <img class="show-card-img" src="images/friends.jpg" alt="Friends TV Show"
          onerror="this.style.display='none'; document.getElementById('friends-placeholder').style.display='flex';">
        <div class="show-card-img-placeholder" id="friends-placeholder" style="display:none">&#128107;</div>
        <div class="show-card-body">
          <div class="show-card-title">Friends</div>
          <div class="show-card-meta">10 Seasons &middot; 236 Episodes &middot; Real everyday expressions</div>
        </div>
        <span class="show-badge">&#128293; Popular</span>
      </a>

      <!-- THE OFFICE â€” Coming Soon -->
      <div class="show-card disabled" title="Coming soon â€” not available yet">
        <div style="position:relative;overflow:hidden;">
          <img class="show-card-img" src="images/the_office.png" alt="The Office"
            style="filter:blur(4px) grayscale(40%) brightness(0.7); pointer-events:none; user-select:none;">
          <div style="position:absolute;inset:0;display:flex;align-items:center;justify-content:center;">
            <span style="background:rgba(13,27,46,0.78);color:var(--accent);font-size:0.78rem;font-weight:900;
              padding:6px 14px;border-radius:20px;letter-spacing:1px;text-transform:uppercase;
              border:1px solid var(--accent);backdrop-filter:blur(2px);">&#128679; Coming Soon</span>
          </div>
        </div>
        <div class="show-card-body">
          <div class="show-card-title">The Office</div>
          <div class="show-card-meta">Study content in preparation &mdash; stay tuned!</div>
        </div>
        <span class="show-badge coming-badge">Coming Soon</span>
      </div>

      <!-- MODERN FAMILY â€” Coming Soon -->
      <div class="show-card disabled" title="Coming soon â€” not available yet">
        <div style="position:relative;overflow:hidden;">
          <img class="show-card-img" src="images/modern_family.png" alt="Modern Family"
            style="filter:blur(4px) grayscale(40%) brightness(0.7); pointer-events:none; user-select:none;">
          <div style="position:absolute;inset:0;display:flex;align-items:center;justify-content:center;">
            <span style="background:rgba(13,27,46,0.78);color:var(--accent);font-size:0.78rem;font-weight:900;
              padding:6px 14px;border-radius:20px;letter-spacing:1px;text-transform:uppercase;
              border:1px solid var(--accent);backdrop-filter:blur(2px);">&#128679; Coming Soon</span>
          </div>
        </div>
        <div class="show-card-body">
          <div class="show-card-title">Modern Family</div>
          <div class="show-card-meta">Study content in preparation &mdash; stay tuned!</div>
        </div>
        <span class="show-badge coming-badge">Coming Soon</span>
      </div>

    </div>
  </div>
</main>


<!-- =====================================================
     PWA INSTALL BANNER
====================================================== -->
<div class="install-banner" id="installBanner">
  <div class="install-banner-icon">&#128241;</div>
  <div class="install-banner-text">
    <strong>ì•±ìœ¼ë¡œ ì„¤ì¹˜í•˜ê¸° / Install App</strong>
    <span>í™ˆ í™”ë©´ì— ì¶”ê°€í•˜ë©´ ì˜¤í”„ë¼ì¸ì—ì„œë„ ì‚¬ìš© ê°€ëŠ¥í•©ë‹ˆë‹¤<br>Add to home screen for offline use</span>
  </div>
  <div class="install-banner-actions">
    <button class="btn-install" id="btnInstall" onclick="installApp()">&#8595; Install</button>
    <button class="btn-dismiss" onclick="dismissInstall()">ë‚˜ì¤‘ì—</button>
  </div>
</div>

<!-- Fix banner: shown if user had the broken install -->
<div class="install-banner" id="fixBanner" style="border-color:var(--accent2);">
  <div class="install-banner-icon">&#128736;</div>
  <div class="install-banner-text">
    <strong>ì•± ì˜¤ë¥˜ ìˆ˜ì • / Fix App (404 Error)</strong>
    <span>ì´ì „ ë²„ì „ ìºì‹œë¥¼ ì‚­ì œí•˜ê³  ì¬ì„¤ì¹˜í•˜ì„¸ìš”<br>Clear old cache and reinstall to fix 404</span>
  </div>
  <div class="install-banner-actions">
    <button class="btn-install" style="background:var(--accent2)" onclick="clearAndReload()">&#128465; Fix &amp; Reload</button>
    <button class="btn-dismiss" onclick="document.getElementById('fixBanner').classList.remove('show')">&#10005;</button>
  </div>
</div>


<script src="js/app.js"></script>
<script>

  /* â”€â”€ PWA: Service Worker Registration (v2 â€” fixed paths) â”€â”€ */
  if ('serviceWorker' in navigator) {
    window.addEventListener('load', function() {

      /* Unregister any previously broken SW versions */
      navigator.serviceWorker.getRegistrations().then(function(regs) {
        regs.forEach(function(reg) {
          var swUrl = (reg.active && reg.active.scriptURL) || '';
          if (swUrl && swUrl.indexOf('sw.js') === -1) {
            reg.unregister();
            console.log('[PWA] Removed stale SW:', swUrl);
          }
        });
      });

      /* Register updated SW with explicit relative scope */
      navigator.serviceWorker.register('./sw.js', { scope: './' })
        .then(function(reg) {
          console.log('[PWA] SW v2 registered, scope:', reg.scope);
          reg.addEventListener('updatefound', function() {
            var nw = reg.installing;
            if (!nw) return;
            nw.addEventListener('statechange', function() {
              if (nw.state === 'installed' && navigator.serviceWorker.controller) {
                showToast('\u21bb Update ready \u2014 refresh to apply');
              }
            });
          });
        })
        .catch(function(err) { console.warn('[PWA] SW registration failed:', err); });
    });
  }

  /* â”€â”€ PWA: Install Prompt â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
  var _deferredPrompt = null;

  window.addEventListener('beforeinstallprompt', function(e) {
    e.preventDefault();
    _deferredPrompt = e;
    // Only show install banner if user hasn't dismissed it before
    if (!localStorage.getItem('de_install_dismissed')) {
      document.getElementById('installBanner').classList.add('show');
    }
  });

  window.addEventListener('appinstalled', function() {
    document.getElementById('installBanner').classList.remove('show');
    _deferredPrompt = null;
    showToast('&#10003; App installed! Check your home screen.');
  });

  function installApp() {
    if (!_deferredPrompt) return;
    _deferredPrompt.prompt();
    _deferredPrompt.userChoice.then(function(result) {
      if (result.outcome === 'accepted') {
        showToast('&#10003; Installing Daily English...');
      }
      _deferredPrompt = null;
      document.getElementById('installBanner').classList.remove('show');
    });
  }

  function dismissInstall() {
    document.getElementById('installBanner').classList.remove('show');
    localStorage.setItem('de_install_dismissed', '1');
  }

  /* â”€â”€ Clear old broken cache and hard-reload â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
  function clearAndReload() {
    document.getElementById('fixBanner').classList.remove('show');
    showToast('&#128465; Clearing cache...');

    var clearDone = false;

    /* 1. Tell SW to clear its caches */
    if (navigator.serviceWorker && navigator.serviceWorker.controller) {
      navigator.serviceWorker.controller.postMessage({ type: 'CLEAR_CACHE' });
    }

    /* 2. Unregister all service workers */
    if ('serviceWorker' in navigator) {
      navigator.serviceWorker.getRegistrations().then(function(regs) {
        return Promise.all(regs.map(function(r) { return r.unregister(); }));
      }).then(function() {
        console.log('[Fix] All SWs unregistered');
      });
    }

    /* 3. Clear Cache API directly from the page */
    if ('caches' in window) {
      caches.keys().then(function(keys) {
        return Promise.all(keys.map(function(k) { return caches.delete(k); }));
      }).then(function() {
        console.log('[Fix] CacheStorage cleared');
        if (!clearDone) {
          clearDone = true;
          setTimeout(function() { window.location.reload(true); }, 600);
        }
      });
    } else {
      setTimeout(function() { window.location.reload(true); }, 800);
    }
  }

  /* â”€â”€ Auto-show fix banner if app was opened after a 404 â”€â”€â”€â”€ */
  (function() {
    /* If the page loaded with ?fix=1 query param (linked from error screen) */
    if (window.location.search.indexOf('fix=1') !== -1) {
      setTimeout(function() {
        document.getElementById('fixBanner').classList.add('show');
      }, 800);
    }
    /* Or if we detect we're running as installed PWA (standalone) and
       the referrer suggests a failed navigation */
    var isStandalone = window.matchMedia('(display-mode: standalone)').matches
      || window.navigator.standalone === true;
    if (isStandalone && document.referrer === '') {
      /* Running as installed app â€” show subtle fix option in corner */
      setTimeout(function() {
        var fb = document.getElementById('fixBanner');
        if (fb) {
          /* Only show automatically if localStorage flag is set */
          if (localStorage.getItem('de_had_404')) {
            fb.classList.add('show');
            localStorage.removeItem('de_had_404');
          }
        }
      }, 1500);
    }
  })();

  /* â”€â”€ State â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
  let currentLang = 'ko'; // Korean is the primary / default language

  /* â”€â”€ Language Switcher â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
  function setLang(lang) {
    currentLang = lang;

    // Show / hide content panels
    document.getElementById('content-en').classList.toggle('visible', lang === 'en');
    document.getElementById('content-ko').classList.toggle('visible', lang === 'ko');

    // Update pill button styles
    document.getElementById('btn-en').classList.toggle('active', lang === 'en');
    document.getElementById('btn-ko').classList.toggle('active', lang === 'ko');
    document.getElementById('btn-en').setAttribute('aria-pressed', String(lang === 'en'));
    document.getElementById('btn-ko').setAttribute('aria-pressed', String(lang === 'ko'));

    // Update html lang attribute for accessibility & fonts
    document.documentElement.lang = lang;

    // Keep checkbox states in sync across both panels
    mirrorCheckboxState();
  }

  /* â”€â”€ Keep both checkboxes in sync â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
  function mirrorCheckboxState() {
    const cbEn = document.getElementById('agreeCheck-en');
    const cbKo = document.getElementById('agreeCheck-ko');
    // Read from currently visible panel, mirror to the other
    const checked = currentLang === 'ko' ? cbKo.checked : cbEn.checked;
    cbEn.checked = checked;
    cbKo.checked = checked;
    setAgreeBtnsState(checked);
  }

  function setAgreeBtnsState(checked) {
    ['en', 'ko'].forEach(function(lang) {
      var btn = document.getElementById('btnAgree-' + lang);
      btn.classList.toggle('enabled', checked);
      btn.disabled = !checked;
      btn.setAttribute('aria-disabled', String(!checked));
    });
  }

  /* â”€â”€ Checkbox click handlers â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
  function handleCheckClick(lang, e) {
    // Only toggle if click was on the wrapper, not the checkbox itself
    var checkId = 'agreeCheck-' + lang;
    if (e.target.id !== checkId && e.target.tagName !== 'INPUT') {
      var cb = document.getElementById(checkId);
      cb.checked = !cb.checked;
      mirrorCheckboxState();
    }
  }

  function onCheckChange(lang) {
    mirrorCheckboxState();
  }

  /* â”€â”€ Agree & Enter â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
  function agreeAndEnter() {
    var activeCheckId = currentLang === 'ko' ? 'agreeCheck-ko' : 'agreeCheck-en';
    var cb = document.getElementById(activeCheckId);
    if (!cb.checked) return;
    setAgreed();
    document.getElementById('termsOverlay').classList.remove('visible');
    document.getElementById('mainContent').classList.add('visible');
    renderBookmarkBar();
    syncBookmarkButtons();
  }

  function goHome() { window.location.href = 'index.html'; }

  /* â”€â”€ Init â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
  window.addEventListener('DOMContentLoaded', function() {
    var params   = new URLSearchParams(window.location.search);
    var redirect = params.get('redirect');

    if (hasAgreed()) {
      document.getElementById('termsOverlay').classList.remove('visible');
      document.getElementById('mainContent').classList.add('visible');
      renderBookmarkBar();
      syncBookmarkButtons();
      if (redirect) window.location.href = decodeURIComponent(redirect);
    } else {
      // Show terms page in Korean by default
      setLang('ko');
    }
  });

</script>

<footer class="site-footer">
  <div class="footer-copy">&copy; 2025 m2ea Labs. All rights reserved.</div>
  <div><button class="footer-terms" onclick="showTermsModal()">Terms of Use</button></div>
</footer>

<!-- Terms of Use Modal -->
<div id="termsModal" style="display:none;position:fixed;inset:0;z-index:900;background:rgba(9,17,30,0.88);overflow-y:auto;">
  <div style="max-width:580px;margin:40px auto;padding:0 16px 60px;">
    <div style="background:var(--card);border:1px solid var(--border);border-radius:var(--radius);padding:26px 24px;position:relative;">
      <button onclick="closeTermsModal()" style="position:absolute;top:14px;right:16px;background:none;border:none;font-size:1.4rem;color:var(--muted);cursor:pointer;line-height:1;">&times;</button>
      <div style="text-align:center;margin-bottom:16px;">
        <div style="font-size:2.2rem;margin-bottom:8px;">&#128214;</div>
        <div style="font-size:1.2rem;font-weight:900;color:var(--accent);">Terms of Use</div>
        <div style="font-size:0.78rem;color:var(--muted);margin-top:4px;">Daily English &mdash; ONE Expression per DAY &nbsp;|&nbsp; by m2ea Labs</div>
      </div>
      <!-- Agreed badge â€” shown only if user has already agreed -->
      <div id="agreedBadge" style="display:none;background:rgba(34,197,94,0.12);border:1.5px solid #22c55e;border-radius:10px;padding:11px 16px;margin-bottom:16px;display:flex;align-items:center;gap:10px;">
        <span style="font-size:1.3rem;flex-shrink:0;">&#9989;</span>
        <div>
          <div style="font-size:0.85rem;font-weight:900;color:#22c55e;">You have agreed to these Terms of Use.</div>
          <div style="font-size:0.76rem;color:var(--muted);margin-top:2px;">Your agreement is saved on this device. Thank you for using Daily English responsibly.</div>
        </div>
      </div>
      <div style="background:var(--card2);border:1px solid var(--border);border-radius:10px;padding:16px 18px;margin-bottom:14px;">
        <div style="font-size:0.82rem;font-weight:900;color:var(--accent2);margin-bottom:10px;">&#128204; Terms of Use</div>
        <ul style="list-style:none;padding:0;margin:0;">
          <li style="font-size:0.85rem;color:var(--text);line-height:1.75;padding:8px 0 8px 16px;border-bottom:1px solid var(--border);position:relative;">
            <span style="position:absolute;left:0;color:var(--accent);">&#9658;</span>
            This app is for <strong>study purposes only</strong>. All video clips&rsquo; rights belong to each respective company. If any company requests content removal, all contents can be removed without prior notice.
          </li>
          <li style="font-size:0.85rem;color:var(--text);line-height:1.75;padding:8px 0 8px 16px;border-bottom:1px solid var(--border);position:relative;">
            <span style="position:absolute;left:0;color:var(--accent);">&#9658;</span>
            You <strong>cannot use this content for any other purposes</strong>. Use is strictly limited to <strong>personal study only</strong>. Any commercial, redistribution, or other non-personal use is prohibited.
          </li>
          <li style="font-size:0.85rem;color:var(--text);line-height:1.75;padding:8px 0 0 16px;position:relative;">
            <span style="position:absolute;left:0;color:var(--accent);">&#9658;</span>
            All study contents and comments <strong>may contain incorrect or inaccurate information</strong>. All explanations and comments represent a <strong>m2ea Labs opinion</strong>. If you have a different idea or opinion, <em>you are right</em> &mdash; please use your own judgment.
          </li>
        </ul>
      </div>
      <div style="background:var(--card2);border:1px solid var(--border);border-radius:10px;padding:16px 18px;margin-bottom:18px;">
        <div style="font-size:0.82rem;font-weight:900;color:var(--accent2);margin-bottom:10px;">&#8505;&#65039; About This App</div>
        <p style="font-size:0.85rem;color:var(--text);line-height:1.75;margin:0 0 8px;">Daily English connects short YouTube video clips to real English expressions used in popular TV shows. Each expression includes its meaning, an example sentence, and a link to a short video clip for context.</p>
        <p style="font-size:0.85rem;color:var(--text);line-height:1.75;margin:0;">This app is operated by <strong>m2ea Labs</strong> as a study group project. All video content remains the property of its original owners. YouTube video clips and shorts may include ads served by YouTube.</p>
      </div>
      <button onclick="closeTermsModal()" style="width:100%;background:linear-gradient(135deg,var(--accent),#0ea5e9);color:var(--bg);border:none;border-radius:10px;padding:13px;font-size:0.95rem;font-weight:900;cursor:pointer;font-family:inherit;">
        Close &nbsp;&times;
      </button>
    </div>
  </div>
</div>

<script>
  function showTermsModal() {
    document.getElementById('termsModal').style.display = 'block';
    document.body.style.overflow = 'hidden';
    // Show agreed badge if user has already accepted terms
    var badge = document.getElementById('agreedBadge');
    if (badge) {
      badge.style.display = (localStorage.getItem('de_agreed') === '1') ? 'flex' : 'none';
    }
  }
  function closeTermsModal() {
    document.getElementById('termsModal').style.display = 'none';
    document.body.style.overflow = '';
  }
  // Close on backdrop click
  document.getElementById('termsModal').addEventListener('click', function(e) {
    if (e.target === this) closeTermsModal();
  });
</script>
</body>
</html>
